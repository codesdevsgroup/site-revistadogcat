<div class="artigo-detalhe-container">


  <!-- Main Content -->
  <div class="content-wrapper">
    <form [formGroup]="artigoForm" (ngSubmit)="onSubmit()">

      <!-- Configurações Horizontais no Topo -->
      <div class="config-section">
        <div class="config-header">
          <h3 class="config-title">
            <i class="fas fa-cog me-2"></i>
            Configurações
          </h3>
          <div class="config-actions">
            <button type="button" class="btn btn-outline-secondary me-2" (click)="onCancel()">
              <i class="fas fa-times me-1"></i>
              Cancelar
            </button>
            <button type="button" class="btn btn-primary" (click)="onSubmit()" [disabled]="artigoForm.invalid">
              <i class="fas fa-save me-1"></i>
              {{ isEditMode ? 'Atualizar' : 'Salvar' }}
            </button>
          </div>
        </div>
        <div class="config-content">
          <!-- Layout em Grid: Esquerda/Centro + Direita -->
          <div class="config-row config-row-main-grid">
            <!-- Coluna Esquerda/Centro -->
            <div class="left-column">
              <h1 class="page-title">
        {{ isEditMode ? 'Editar Artigo' : 'Novo Artigo' }}
      </h1>
              <!-- Primeira linha: Título -->
              <div class="config-row">
                <div class="form-group">
                  <label for="titulo" class="form-label">Título *</label>
                  <input
                    type="text"
                    id="titulo"
                    class="form-control"
                    formControlName="titulo"
                    [class.is-invalid]="titulo?.invalid && titulo?.touched"
                    placeholder="Digite o título do artigo"
                  >
                  <div class="invalid-feedback" *ngIf="titulo?.invalid && titulo?.touched">
                    <div *ngIf="titulo?.errors?.['required']">Título é obrigatório</div>
                    <div *ngIf="titulo?.errors?.['minlength']">Título deve ter pelo menos 3 caracteres</div>
                  </div>
                </div>
              </div>

              <!-- Segunda linha: Resumo (Opcional) -->
              <div class="config-row">
                <div class="form-group resumo-field">
                  <label for="resumo" class="form-label">
                    Resumo
                    <small class="text-muted">(opcional)</small>
                  </label>
                  <textarea
                    id="resumo"
                    class="form-control"
                    formControlName="resumo"
                    [class.is-invalid]="resumo?.invalid && resumo?.touched"
                    rows="3"
                    placeholder="Digite um breve resumo sobre o artigo (opcional)"
                    maxlength="300"
                  ></textarea>
                  <div class="form-text">
                    <small class="character-counter"
                           [class.text-warning]="(resumo?.value?.length || 0) > 250"
                           [class.text-danger]="(resumo?.value?.length || 0) > 290">
                      <i class="fas fa-info-circle me-1"></i>
                      O resumo ajuda os leitores a entender rapidamente o conteúdo do artigo.
                      Máximo de 300 caracteres. ({{ resumo?.value?.length || 0 }}/300)
                    </small>
                    <div *ngIf="resumo?.invalid && resumo?.touched" class="invalid-feedback d-block">
                      <small *ngIf="resumo?.errors?.['maxlength']" class="text-danger">
                        O resumo deve ter no máximo 300 caracteres.
                      </small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Terceira linha: Autor, Categoria e Público -->
              <div class="config-row config-row-three-cols">
                <div class="form-group">
                  <label for="autor" class="form-label">Autor *</label>
                  <select
                    id="autor"
                    class="form-select"
                    formControlName="autor"
                    [class.is-invalid]="autor?.invalid && autor?.touched"
                  >
                    <option value="">Selecione um autor</option>
                    <option *ngFor="let autor of autores" [value]="autor.id">
                      {{ autor.nome }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="autor?.invalid && autor?.touched">
                    Autor é obrigatório
                  </div>
                </div>

                <div class="form-group">
                  <label for="categoria" class="form-label">Categoria *</label>
                  <select
                    id="categoria"
                    class="form-select"
                    formControlName="categoria"
                    [class.is-invalid]="categoria?.invalid && categoria?.touched"
                  >
                    <option value="">Selecione uma categoria</option>
                    <option *ngFor="let cat of categorias" [value]="cat.id">
                      {{ cat.nome }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="categoria?.invalid && categoria?.touched">
                    Categoria é obrigatória
                  </div>
                </div>

                <div class="form-group">
                  <label for="publico" class="form-label">Público *</label>
                  <select
                    id="publico"
                    class="form-select"
                    formControlName="publico"
                    [class.is-invalid]="publico?.invalid && publico?.touched"
                  >
                    <option *ngFor="let pub of publicoOptions" [value]="pub.value">
                      {{ pub.label }}
                    </option>
                  </select>
                  <div class="form-text">
                    <i class="fas fa-info-circle me-1"></i>
                    <span class="text-success" *ngIf="publico?.value === 'publico'">Visível para todos os visitantes</span>
                    <span class="text-warning" *ngIf="publico?.value === 'assinantes'">Visível apenas para assinantes</span>
                    <span class="text-danger" *ngIf="publico?.value === 'privado'">Visível apenas para administradores</span>
                  </div>
                  <div class="invalid-feedback" *ngIf="publico?.invalid && publico?.touched">
                    Público é obrigatório
                  </div>
                </div>
              </div>

              <!-- Terceira linha: Data de Publicação e Status -->
              <div class="config-row config-row-two-cols">
                <div class="form-group">
                  <label for="dataPublicacao" class="form-label">Data de Publicação *</label>
                  <input
                    type="date"
                    id="dataPublicacao"
                    class="form-control"
                    formControlName="dataPublicacao"
                    [class.is-invalid]="dataPublicacao?.invalid && dataPublicacao?.touched"
                  >
                  <div class="invalid-feedback" *ngIf="dataPublicacao?.invalid && dataPublicacao?.touched">
                    Data de publicação é obrigatória
                  </div>
                </div>

                <div class="form-group">
                  <label for="status" class="form-label">Status *</label>
                  <select
                    id="status"
                    class="form-select"
                    formControlName="status"
                    [class.is-invalid]="status?.invalid && status?.touched"
                  >
                    <option *ngFor="let st of statusOptions" [value]="st.value">
                      {{ st.label }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="status?.invalid && status?.touched">
                    Status é obrigatório
                  </div>
                </div>
              </div>
            </div>

            <!-- Coluna Direita: Apenas Foto de Destaque -->
            <div class="right-column">
              <div class="form-group foto-destaque-group">
                <label for="fotoDestaque" class="form-label">Foto de Destaque *</label>

                <!-- Preview da imagem -->
                <div class="foto-destaque-container" *ngIf="fotoDestaque">
                  <div class="foto-preview">
                    <img [src]="fotoDestaque" alt="Preview da foto de destaque" class="preview-image">
                    <button type="button" class="btn-remove-foto" (click)="removerFotoDestaque()" title="Remover foto">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </div>

                <!-- Input de upload -->
                <div class="upload-area" *ngIf="!fotoDestaque">
                  <input
                    #fotoDestaqueInput
                    type="file"
                    id="fotoDestaque"
                    class="form-control-file"
                    accept="image/jpeg,image/png,image/webp"
                    (change)="onFotoDestaqueChange($event)"
                    [class.is-invalid]="fotoDestaqueControl?.invalid && fotoDestaqueControl?.touched"
                  >
                  <div class="upload-placeholder">
                    <label for="fotoDestaque" class="upload-label">
                      <i class="fas fa-cloud-upload-alt"></i>
                      <span>Clique para selecionar uma imagem</span>
                      <small>JPEG, PNG ou WebP - Máximo 5MB</small>
                    </label>
                  </div>
                </div>
                <div class="invalid-feedback" *ngIf="fotoDestaqueControl?.invalid && fotoDestaqueControl?.touched">
                  Foto de destaque é obrigatória
                </div>
              </div>
            </div>
          </div>

          <!-- Terceira linha - Informações do Artigo -->
          <div class="config-row" *ngIf="isEditMode">

            <!-- Informações do Artigo -->
            <div class="info-section">
              <h4 class="info-title">Informações</h4>
              <div class="info-items">
                <div class="info-item">
                  <span class="info-label">ID:</span>
                  <span class="info-value">#{{ artigoId }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Criado em:</span>
                  <span class="info-value">15/01/2024</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Última edição:</span>
                  <span class="info-value">20/01/2024</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Área Central - Editor -->
      <div class="editor-area">
        <div class="editor-header">
          <h3 class="editor-title">
            <i class="fas fa-edit me-2"></i>
            Conteúdo do Artigo
          </h3>
          <div class="editor-info">
            <small class="text-muted">
              <i class="fas fa-info-circle me-1"></i>
              Use o editor abaixo para criar o conteúdo do seu artigo
            </small>
          </div>
        </div>

        <!-- Placeholder para o Tiptap Editor -->
        <div class="editor-container">
          <div class="tiptap-placeholder">
            <div class="placeholder-content">

              <!-- Tiptap Editor -->
              <app-tiptap-editor
                formControlName="conteudo"
                placeholder="Digite o conteúdo do artigo aqui..."
                [class.is-invalid]="conteudo?.invalid && conteudo?.touched"
              ></app-tiptap-editor>

              <div class="invalid-feedback" *ngIf="conteudo?.invalid && conteudo?.touched">
                Conteúdo é obrigatório
              </div>
            </div>
          </div>
        </div>

        <!-- Contador de caracteres -->
        <div class="editor-footer">
          <small class="text-muted">
            <i class="fas fa-keyboard me-1"></i>
            {{ conteudo?.value?.length || 0 }} caracteres
          </small>
        </div>
      </div>

    </form>
  </div>
</div>
