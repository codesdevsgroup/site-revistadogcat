<div class="cadastro-container">
  <!-- Hero Header -->
  <section class="hero-header">
    <div class="container">
      <div class="row justify-content-center text-center">
        <div class="col-lg-8">
          <div class="hero-content">
            <div class="hero-icon">üèÜ</div>
            <h1>Expo Dog BR</h1>
            <p class="hero-subtitle">A primeira mostra 100% online do Brasil</p>
            <p class="hero-description">
              Com tradi√ß√£o de mais de 150 anos, as exposi√ß√µes de c√£es ganham um novo formato que democratiza o acesso e valoriza criadores e suas ra√ßas em todo o pa√≠s.
            </p>
            <div class="registration-options">
              <div class="option-card active" (click)="scrollToForm()">
                <div class="option-icon">üíª</div>
                <h3>Cadastro Online</h3>
                <p>Preencha o formul√°rio abaixo</p>
                <div class="option-badge">Recomendado</div>
              </div>
              <div class="option-divider">ou</div>
              <div class="option-card whatsapp-option" (click)="openWhatsAppRegistration()">
                <div class="option-icon">üì±</div>
                <h3>Cadastro via WhatsApp</h3>
                <p>Atendimento personalizado</p>
                <div class="option-note">Alternativa ao formul√°rio</div>
              </div>
            </div>
            <div class="form-instruction" (click)="scrollToForm()">
              <p>üëá Complete o formul√°rio abaixo para se cadastrar na Expo Dog BR</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Progress Steps -->
  <section class="progress-section">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="progress-steps">
            <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
              <div class="step-number">1</div>
              <div class="step-label">Dados Pessoais</div>
            </div>
            <div class="step-line" [class.active]="currentStep > 1"></div>
            <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
              <div class="step-number">2</div>
              <div class="step-label">Dados do C√£o</div>
            </div>
            <div class="step-line" [class.active]="currentStep > 2"></div>
            <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
              <div class="step-number">3</div>
              <div class="step-label">V√≠deo de Apresenta√ß√£o</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Form Content -->
  <section class="form-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="form-card">
            <!-- Step 1: Dados Pessoais -->
            <div class="form-step" [class.active]="currentStep === 1">
              <div class="step-header">
                <h2>üë§ Dados Pessoais</h2>
                <p>Informa√ß√µes do propriet√°rio do c√£o</p>
              </div>

              <form [formGroup]="userForm" class="step-form">
                <!-- Op√ß√£o de Propriet√°rio (destaque para cadastro de terceiros) -->
                <div class="third-party-owner-block mb-4 p-3 rounded">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="proprietarioDiferente" (change)="toggleProprietarioDiferente()" aria-describedby="thirdPartyHelp">
                    <label class="form-check-label fw-semibold" for="proprietarioDiferente">
                      O propriet√°rio do c√£o √© outra pessoa?
                    </label>
                  </div>
                  <small id="thirdPartyHelp" class="text-danger d-block mt-1">(marque para cadastro para terceiros)</small>
                </div>

                <!-- Campos do Formul√°rio (condicionais) -->
                <div *ngIf="proprietarioDiferente || !usuarioLogado">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="nomeCompleto" class="form-label">Nome Completo *</label>
                      <input type="text" id="nomeCompleto" class="form-control" formControlName="nomeCompleto" placeholder="Nome completo do propriet√°rio">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="cpf" class="form-label">CPF *</label>
                      <input type="text" id="cpf" class="form-control" 
                             [class.is-invalid]="userForm.get('cpf')?.invalid && userForm.get('cpf')?.touched"
                             formControlName="cpf" placeholder="000.000.000-00">
                      <div class="invalid-feedback" *ngIf="userForm.get('cpf')?.invalid && userForm.get('cpf')?.touched">
                        <span *ngIf="userForm.get('cpf')?.errors?.['required']">CPF √© obrigat√≥rio</span>
                        <span *ngIf="userForm.get('cpf')?.errors?.['cpfInvalido']">CPF inv√°lido</span>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="email" class="form-label">Email *</label>
                      <input type="email" id="email" class="form-control" formControlName="email" placeholder="seuemail@dominio.com">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="telefone" class="form-label">Telefone / WhatsApp *</label>
                      <input type="tel" id="telefone" class="form-control" formControlName="telefone" placeholder="(00) 90000-0000">
                    </div>
                  </div>
                   <div class="row">
                    <div class="col-md-4 mb-3">
                      <label for="cep" class="form-label">CEP</label>
                      <div class="input-group">
                        <input type="text" id="cep" class="form-control" formControlName="cep" placeholder="00000-000" (input)="formatCep($event)" (change)="onCepChange($event)">
                        <div *ngIf="isCepLoading" class="input-group-text">
                          <div class="cep-loading-spinner" role="status" aria-label="Buscando CEP">
                            <span class="sr-only">Buscando CEP...</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-8 mb-3">
                      <label for="endereco" class="form-label">Endere√ßo</label>
                      <input type="text" id="endereco" class="form-control" formControlName="endereco" placeholder="Rua, n√∫mero, bairro">
                    </div>
                  </div>
                   <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="cidade" class="form-label">Cidade</label>
                      <input type="text" id="cidade" class="form-control" formControlName="cidade" placeholder="Sua cidade">
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="estado" class="form-label">Estado</label>
                      <input type="text" id="estado" class="form-control" formControlName="estado" placeholder="Seu estado">
                    </div>
                  </div>
                </div>

                 <!-- Mensagem para usu√°rio logado -->
                <div *ngIf="!proprietarioDiferente && usuarioLogado" class="logged-in-user-info">
                  <p>Os dados do propriet√°rio ser√£o os mesmos do seu cadastro:</p>
                  <ul>
                    <li><strong>Nome:</strong> {{ usuarioLogado.name }}</li>
                    <li><strong>Email:</strong> {{ usuarioLogado.email }}</li>
                  </ul>
                  <p>Se precisar alterar, marque a op√ß√£o acima.</p>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!userForm.valid && proprietarioDiferente">Pr√≥ximo: Dados do C√£o</button>
                </div>
              </form>
            </div>

            <!-- Step 2: Dados do C√£o -->
            <div class="form-step" [class.active]="currentStep === 2">
              <div class="step-header">
                <h2>üêï Dados do C√£o</h2>
                <p>Informa√ß√µes completas do seu c√£o</p>
              </div>

              <form [formGroup]="dogForm" class="step-form">

                <div class="row">
                  <div class="col-md-6 mb-3">
                      <label for="nomeCao" class="form-label">Nome do C√£o *</label>
                      <input type="text" id="nomeCao" class="form-control" formControlName="nome" placeholder="Nome do seu c√£o">
                  </div>
                  <div class="col-md-6 mb-3">
                      <label for="raca" class="form-label">Ra√ßa *</label>
                      <select id="raca" class="form-select" formControlName="raca">
                          <option value="" disabled selected>
                            {{ racasLoading ? 'Carregando ra√ßas...' : 'Selecione a ra√ßa' }}
                          </option>
                          <ng-container *ngIf="!racasLoading && racas.length > 0; else racasFallback">
                            <option *ngFor="let raca of racas; trackBy: trackByRaca" [value]="raca">{{ raca }}</option>
                          </ng-container>
                      </select>
                      <ng-template #racasFallback>
                        <div class="form-text" aria-live="polite">
                          {{ racasError ? 'N√£o foi poss√≠vel carregar as ra√ßas. Tente novamente mais tarde.' : 'Nenhuma ra√ßa encontrada.' }}
                        </div>
                      </ng-template>
                  </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="sexo" class="form-label">Sexo *</label>
                        <select id="sexo" class="form-select" formControlName="sexo">
                            <option value="" disabled>Selecione o sexo</option>
                            <option value="MACHO">Macho</option>
                            <option value="FEMEA">F√™mea</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="dataNascimento" class="form-label">Data de Nascimento *</label>
                        <input type="date" id="dataNascimento" class="form-control" formControlName="dataNascimento">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="peso" class="form-label">Peso (kg)</label>
                        <input type="number" id="peso" class="form-control" formControlName="peso" placeholder="Ex: 25.5">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="altura" class="form-label">Altura (cm)</label>
                        <input type="number" id="altura" class="form-control" formControlName="altura" placeholder="Ex: 60">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="caracteristicas" class="form-label">Caracter√≠sticas e Temperamento</label>
                    <textarea id="caracteristicas" class="form-control" formControlName="caracteristicas" rows="3" placeholder="Descreva brevemente o temperamento, caracter√≠sticas f√≠sicas not√°veis, etc."></textarea>
                </div>

                <!-- Se√ß√£o Pedigree (Refatorada com Toggle Switch) -->
                <div class="pedigree-section mb-4">
                  <div class="section-card">
                    <div class="d-flex justify-content-between align-items-center">
                      <h4><i class="fas fa-certificate"></i> O c√£o possui pedigree?</h4>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="temPedigree" formControlName="temPedigree">
                        <label class="form-check-label" for="temPedigree">{{ dogForm.get('temPedigree')?.value ? 'SIM' : 'N√ÉO' }}</label>
                      </div>
                    </div>
                    <div class="pedigree-details mt-3" *ngIf="dogForm.get('temPedigree')?.value">
                      <div class="row">
                          <div class="col-md-6 mb-3">
                              <label for="registroPedigree" class="form-label">N¬∫ de Registro do Pedigree *</label>
                              <input type="text" id="registroPedigree" class="form-control" formControlName="registroPedigree" placeholder="N√∫mero de registro">
                          </div>
                      </div>
                      <div class="mb-3">
                          <label for="nomePai" class="form-label">Nome do Pai (no pedigree)</label>
                          <input type="text" id="nomePai" class="form-control" formControlName="nomePai" placeholder="Nome do pai conforme pedigree">
                      </div>
                      <div class="mb-3">
                          <label for="nomeMae" class="form-label">Nome da M√£e (no pedigree)</label>
                          <input type="text" id="nomeMae" class="form-control" formControlName="nomeMae" placeholder="Nome da m√£e conforme pedigree">
                      </div>
                      <div class="mb-3">
                          <label for="titulos" class="form-label">T√≠tulos e Pr√™mios</label>
                          <textarea id="titulos" class="form-control" formControlName="titulos" rows="2" placeholder="Campe√£o Brasileiro, Grande Campe√£o, etc."></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Se√ß√£o Microchip (Refatorada com Toggle Switch) -->
                <div class="microchip-section mb-4">
                  <div class="section-card">
                    <div class="d-flex justify-content-between align-items-center">
                      <h4><i class="fas fa-microchip"></i> O c√£o possui microchip?</h4>
                      <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="temMicrochip" formControlName="temMicrochip">
                        <label class="form-check-label" for="temMicrochip">{{ dogForm.get('temMicrochip')?.value ? 'SIM' : 'N√ÉO' }}</label>
                      </div>
                    </div>
                    <div class="microchip-details mt-3" *ngIf="dogForm.get('temMicrochip')?.value">
                      <div class="row">
                          <div class="col-md-6 mb-3">
                              <label for="numeroMicrochip" class="form-label">N¬∫ do Microchip *</label>
                              <input type="text" id="numeroMicrochip" class="form-control" formControlName="numeroMicrochip" placeholder="N√∫mero de 15 d√≠gitos">
                          </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-actions">
                  <button type="button" class="btn btn-secondary" (click)="prevStep()">Voltar</button>
                  <button type="button" class="btn btn-primary" (click)="nextStep()" [disabled]="!dogForm.valid">Pr√≥ximo: V√≠deo</button>
                </div>
              </form>
            </div>

            <!-- Step 3: V√≠deo -->
            <div class="form-step" [class.active]="currentStep === 3">
              <div class="step-header">
                <h2>üé¨ V√≠deo de Apresenta√ß√£o</h2>
                <p>Escolha como deseja enviar o v√≠deo de apresenta√ß√£o do seu c√£o</p>
              </div>

              <div class="video-section">
                <!-- Op√ß√µes de v√≠deo -->
                <div class="video-options d-flex gap-3 mb-4">
                  <button type="button" class="btn" [class.btn-primary]="videoOption === 'upload'" [class.btn-outline-primary]="videoOption !== 'upload'" (click)="selectVideoOption('upload')">
                    Enviar arquivo de v√≠deo
                  </button>
                  <button type="button" class="btn" [class.btn-primary]="videoOption === 'youtube'" [class.btn-outline-primary]="videoOption !== 'youtube'" (click)="selectVideoOption('youtube')">
                    Link do YouTube
                  </button>
                  <button type="button" class="btn" [class.btn-primary]="videoOption === 'whatsapp'" [class.btn-outline-primary]="videoOption !== 'whatsapp'" (click)="selectVideoOption('whatsapp')">
                    Enviar por WhatsApp
                  </button>
                </div>

                <!-- Upload de arquivo -->
                <div *ngIf="videoOption === 'upload'" class="video-option">
                  <p class="form-text">Formatos aceitos: MP4, MOV, AVI, WMV. Dura√ß√£o recomendada: at√© 20 segundos.</p>
                  <input #fileInput type="file" class="d-none" (change)="onFileSelected($event)" accept="video/*">
                  <div class="d-flex gap-2 mb-2">
                    <button type="button" class="btn btn-outline-secondary" (click)="triggerFileInput()">Selecionar v√≠deo</button>
                    <button type="button" class="btn btn-outline-danger" (click)="removeFile()" [disabled]="!selectedFile">Remover</button>
                  </div>
                  <div *ngIf="selectedFile" class="mb-2">
                    <strong>Arquivo:</strong> {{ selectedFile.name }}
                  </div>
                  <div *ngIf="uploadProgress > 0" class="progress" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" [style.width.%]="uploadProgress" [attr.aria-valuenow]="uploadProgress" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>

                <!-- Link do YouTube -->
                <div *ngIf="videoOption === 'youtube'" class="video-option">
                  <form [formGroup]="videoForm">
                    <div class="mb-3">
                      <label for="videoUrl" class="form-label">URL do v√≠deo no YouTube *</label>
                      <input id="videoUrl" type="url" class="form-control" formControlName="videoUrl" placeholder="https://www.youtube.com/watch?v=...">
                      <div class="form-text">Insira um link v√°lido do YouTube.</div>
                    </div>
                  </form>
                </div>

                <!-- Envio por WhatsApp -->
                <div *ngIf="videoOption === 'whatsapp'" class="video-option">
                  <form [formGroup]="videoForm">
                    <div class="form-check mb-3">
                      <input id="confirmaWhatsapp" class="form-check-input" type="checkbox" formControlName="confirmaWhatsapp">
                      <label class="form-check-label" for="confirmaWhatsapp">Confirmo que enviarei o v√≠deo pelo WhatsApp ap√≥s finalizar o cadastro</label>
                    </div>
                    <div class="alert alert-info">
                      Ap√≥s concluir o cadastro, envie o v√≠deo para nosso n√∫mero de atendimento no WhatsApp.
                    </div>
                  </form>
                </div>
              </div>

              <!-- Resumo de valida√ß√£o com campos faltantes -->
              <div *ngIf="validationErrors && validationErrors.length" class="alert alert-danger" role="alert">
                <strong>Existem campos obrigat√≥rios pendentes:</strong>
                <ul class="mb-0">
                  <li *ngFor="let err of validationErrors">{{ err }}</li>
                </ul>
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="prevStep()">Voltar</button>
                <button type="button" class="btn btn-success" (click)="submitForm()" [disabled]="!isVideoStepValid()">Enviar Cadastro</button>
              </div>
            </div>

            <!-- Success Message -->
            <div class="form-step" [class.active]="currentStep === 4">
              <!-- ... (c√≥digo do passo 4 inalterado) ... -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Modal de sucesso (agradecimento) -->
  <div class="modal-backdrop fade show" *ngIf="showSuccessModal"></div>
  <div class="modal d-block" tabindex="-1" role="dialog" *ngIf="showSuccessModal" aria-modal="true" aria-labelledby="cadastroSucessoTitle">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cadastroSucessoTitle">Cadastro enviado!</h5>
          <button type="button" class="btn-close" aria-label="Fechar" (click)="closeSuccessModal()"></button>
        </div>
        <div class="modal-body">
          <p>Obrigado por cadastrar seu c√£o na Expo Dog BR. Em breve entraremos em contato com mais informa√ß√µes.</p>
          <div class="alert alert-success" *ngIf="successCaoId" role="alert">
            <strong>ID do cadastro:</strong> {{ successCaoId }}
            <div *ngIf="successNomeCao">C√£o: {{ successNomeCao }}</div>
            <div *ngIf="successProprietarioId">Propriet√°rio (ID): {{ successProprietarioId }}</div>
          </div>
          <ng-container [ngSwitch]="videoOption">
            <p *ngSwitchCase="'upload'">Seu v√≠deo foi anexado ao cadastro.</p>
            <p *ngSwitchCase="'youtube'">Recebemos a URL do seu v√≠deo no YouTube.</p>
            <p *ngSwitchCase="'whatsapp'">Lembrete: envie o v√≠deo para nosso WhatsApp conforme combinado.</p>
          </ng-container>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" (click)="closeSuccessModal()">Ok</button>
          <button type="button" class="btn btn-secondary" (click)="goToHome()">Voltar √† p√°gina inicial</button>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer />
