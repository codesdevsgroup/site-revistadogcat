<section class="viewer-container" *ngIf="!loading; else carregando">
  <div class="viewer-body" #viewerBody *ngIf="pdfSrc; else erro">
    <div class="viewer-toolbar" #toolbar *ngIf="isMobile">
      <div class="toolbar-left">
        <button class="btn btn-nav" (click)="prevPage()" [disabled]="currentPage <= 1" title="Página anterior">
          <i class="pi pi-angle-left"></i>
        </button>
        <span class="page-info">{{ currentPage }} / {{ totalPages || '?' }}</span>
        <button class="btn btn-nav" (click)="nextPage()" [disabled]="totalPages > 0 && currentPage >= totalPages" title="Próxima página">
          <i class="pi pi-angle-right"></i>
        </button>
      </div>
      <div class="toolbar-right">
        <button class="btn btn-icon" (click)="toggleViewMode()" [disabled]="isMobile" [title]="pageViewMode === 'book' ? 'Página única' : 'Modo livro'">
          <i class="pi pi-book"></i>
        </button>
        <a class="btn btn-icon" routerLink="/edicoes" title="Voltar">
          <i class="pi pi-arrow-left"></i>
        </a>
      </div>
    </div>

    <div class="viewer-side-toolbar" *ngIf="!isMobile">
      <button class="btn btn-icon" (click)="prevPage()" [disabled]="currentPage <= 1" title="Página anterior">
        <i class="pi pi-angle-up"></i>
      </button>
      <span class="page-info">{{ currentPage }} / {{ totalPages || '?' }}</span>
      <button class="btn btn-icon" (click)="nextPage()" [disabled]="totalPages > 0 && currentPage >= totalPages" title="Próxima página">
        <i class="pi pi-angle-down"></i>
      </button>
      <div class="toolbar-divider"></div>
      <button class="btn btn-icon" (click)="zoomOut()" title="Diminuir zoom">
        <i class="pi pi-minus"></i>
      </button>
      <button class="btn btn-icon" (click)="zoomIn()" title="Aumentar zoom">
        <i class="pi pi-plus"></i>
      </button>
      <div class="toolbar-divider"></div>
      <button class="btn btn-icon" (click)="toggleViewMode()" title="Alternar modo">
        <i class="pi pi-book"></i>
      </button>
      <a class="btn btn-icon" routerLink="/edicoes" title="Voltar">
        <i class="pi pi-arrow-left"></i>
      </a>
    </div>
    <ngx-extended-pdf-viewer
      [src]="pdfSrc"
      [height]="viewerHeight"
      [showBorders]="false"
      [showToolbar]="isMobile"
      [pageViewMode]="pageViewMode"
      [zoom]="computedZoom"
      [page]="currentPage"
      (pageChange)="onPageChange($event)"
      (pagesLoaded)="onPagesLoaded($event)"
    ></ngx-extended-pdf-viewer>

    <div class="mobile-hint-overlay" *ngIf="showMobileHint" (click)="dismissHint()">
      <div class="mobile-hint-card" (click)="$event.stopPropagation()">
        <h3>Leitura em dispositivo maior</h3>
        <p>
          Para melhor experiência em modo revista, recomendamos ler em um computador, notebook ou tablet.
        </p>
        <p>
          No celular, use o modo página única ou ajuste o zoom conforme necessário.
        </p>
        <button class="btn btn-primary" (click)="dismissHint()">OK</button>
      </div>
    </div>
  </div>
</section>

<ng-template #carregando>
  <div class="loading">Carregando edição...</div>
  </ng-template>

<ng-template #erro>
  <div class="error">PDF não disponível.</div>
</ng-template>
